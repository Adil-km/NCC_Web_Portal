{% extends 'dashboard/base.html' %}
{% load static %}

{% block head %}
    <link rel="stylesheet" href="{% static 'dashboard/css/gallery.css' %}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
{% endblock head %}

{% block heading %}
Manage Gallery
{% endblock heading %}


{% block body %}
<section class="gallery-section">
  <div class="gallery-grid" id="galleryGrid">

    {% if images %}
      {% for image in images %}
        <div class="gallery-item">

          <img
            src="{{ image.image.url }}"
            alt="Gallery Image"
            data-desc="{{ image.title }}"
          >

          <div class="actions">
            <form method="GET" action="{% url 'edit_image' image.id %}">
              <button type="submit"  class="update">
                <i class="fa-solid fa-pen-to-square"></i>
                <span>Update</span>
              </button>
            </form>

            <form method="POST" action="{% url 'delete_image' image.id %}">
              {% csrf_token %}
              <button
                type="submit"
                class="delete"
                onclick="return confirm('Are you sure you want to delete this image?')">
                <i class="fa-solid fa-trash"></i>
                <span>Delete</span>
              </button>
            </form>
          </div>

        </div>
        
        {% endfor %}
        {% else %}
        <p>No images.</p>
        {% endif %}
      </div>
        
      <div class="lightbox" id="lightbox">
        <span class="close" onclick="closeLightbox()">×</span>
        <span class="prev" onclick="prevImage()">❮</span>
        <img id="lightboxImg" src="" alt="">
        <div class="description" id="imgDescription"></div>
        <span class="next" onclick="nextImage()">❯</span>
      </div>

  </section>
      
      <script>
        const galleryImages = document.querySelectorAll('#galleryGrid img');
        const lightbox = document.getElementById('lightbox');
        const lightboxImg = document.getElementById('lightboxImg');
        const imgDescription = document.getElementById('imgDescription');
        
        const imageData = Array.from(galleryImages).map(img => ({
          src: img.src,
          desc: img.getAttribute('data-desc')
        }));
        
        let currentIndex = 0;
        
    galleryImages.forEach((img, index) => {
      img.addEventListener('click', () => {
        currentIndex = index;
        showImage();
      });
    });

    function showImage() {
      lightboxImg.src = imageData[currentIndex].src;
      imgDescription.textContent = imageData[currentIndex].desc;
      lightbox.style.display = 'flex';
    }

    function closeLightbox() {
      lightbox.style.display = 'none';
    }

    function nextImage() {
      currentIndex = (currentIndex + 1) % imageData.length;
      showImage();
    }

    function prevImage() {
      currentIndex = (currentIndex - 1 + imageData.length) % imageData.length;
      showImage();
    }

    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') closeLightbox();
      if (e.key === 'ArrowRight') nextImage();
      if (e.key === 'ArrowLeft') prevImage();
    });
  </script>

{% endblock body %}

{% extends 'dashboard/base.html' %}
{% load static %}

{% block head %}
    <link rel="stylesheet" href="{% static 'dashboard/css/gallery.css' %}">
{% endblock head %}

{% block heading %}
Manage Gallery
{% endblock heading %}


{% block body %}
<section class="gallery-section">
  <div class="gallery-grid" id="galleryGrid">

    {% if images %}
      {% for image in images %}
        <div class="gallery-item">

          <img
            src="{{ image.image.url }}"
            alt="Gallery Image"
            data-desc="{{ image.title }}"
          >

          <div class="actions">
            <form method="GET" action="{% url 'edit_image' image.id %}">
              <button 
              title="Update"
              type="submit" 
              class="update">
                <svg xmlns="http://www.w3.org/2000/svg" height="16" width="16" viewBox="0 0 640 640"><path fill="#ffffff" d="M535.6 85.7C513.7 63.8 478.3 63.8 456.4 85.7L432 110.1L529.9 208L554.3 183.6C576.2 161.7 576.2 126.3 554.3 104.4L535.6 85.7zM236.4 305.7C230.3 311.8 225.6 319.3 222.9 327.6L193.3 416.4C190.4 425 192.7 434.5 199.1 441C205.5 447.5 215 449.7 223.7 446.8L312.5 417.2C320.7 414.5 328.2 409.8 334.4 403.7L496 241.9L398.1 144L236.4 305.7zM160 128C107 128 64 171 64 224L64 480C64 533 107 576 160 576L416 576C469 576 512 533 512 480L512 384C512 366.3 497.7 352 480 352C462.3 352 448 366.3 448 384L448 480C448 497.7 433.7 512 416 512L160 512C142.3 512 128 497.7 128 480L128 224C128 206.3 142.3 192 160 192L256 192C273.7 192 288 177.7 288 160C288 142.3 273.7 128 256 128L160 128z"/></svg>
                <span>Update</span>
              </button>
            </form>

            <form method="POST" action="{% url 'delete_image' image.id %}">
              {% csrf_token %}
              <button
              title="Delete"
                type="submit"
                class="delete"
                onclick="return confirm('Are you sure you want to delete this image?')">
                <svg xmlns="http://www.w3.org/2000/svg" height="16" width="16" viewBox="0 0 640 640"><path fill="#ffffff" d="M232.7 69.9L224 96L128 96C110.3 96 96 110.3 96 128C96 145.7 110.3 160 128 160L512 160C529.7 160 544 145.7 544 128C544 110.3 529.7 96 512 96L416 96L407.3 69.9C402.9 56.8 390.7 48 376.9 48L263.1 48C249.3 48 237.1 56.8 232.7 69.9zM512 208L128 208L149.1 531.1C150.7 556.4 171.7 576 197 576L443 576C468.3 576 489.3 556.4 490.9 531.1L512 208z"/></svg>
                <span>Delete</span>
              </button>
            </form>
          </div>

        </div>
        
        {% endfor %}
        {% else %}
        <p>No images.</p>
        {% endif %}

      <div class="add-btn">
      <a href="{% url 'upload_gallery' %}" title="Add gallery">
        <svg fill="#ffffff" width="25px" height="25px" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg"><path d="M512 0C229.232 0 0 229.232 0 512c0 282.784 229.232 512 512 512 282.784 0 512-229.216 512-512C1024 229.232 794.784 0 512 0zm0 961.008c-247.024 0-448-201.984-448-449.01 0-247.024 200.976-448 448-448s448 200.977 448 448-200.976 449.01-448 449.01zM736 480H544V288c0-17.664-14.336-32-32-32s-32 14.336-32 32v192H288c-17.664 0-32 14.336-32 32s14.336 32 32 32h192v192c0 17.664 14.336 32 32 32s32-14.336 32-32V544h192c17.664 0 32-14.336 32-32s-14.336-32-32-32z"/></svg>Add Gallery</a>
      </div>

      </div>
        
      <div class="lightbox" id="lightbox">
        <span class="close" onclick="closeLightbox()">×</span>
        <span class="prev" onclick="prevImage()">❮</span>
        <img id="lightboxImg" src="" alt="">
        <div class="description" id="imgDescription"></div>
        <span class="next" onclick="nextImage()">❯</span>
      </div>

  </section>
      
      <script>
        const galleryImages = document.querySelectorAll('#galleryGrid img');
        const lightbox = document.getElementById('lightbox');
        const lightboxImg = document.getElementById('lightboxImg');
        const imgDescription = document.getElementById('imgDescription');
        
        const imageData = Array.from(galleryImages).map(img => ({
          src: img.src,
          desc: img.getAttribute('data-desc')
        }));
        
        let currentIndex = 0;
        
    galleryImages.forEach((img, index) => {
      img.addEventListener('click', () => {
        currentIndex = index;
        showImage();
      });
    });

    function showImage() {
      lightboxImg.src = imageData[currentIndex].src;
      imgDescription.textContent = imageData[currentIndex].desc;
      lightbox.style.display = 'flex';
    }

    function closeLightbox() {
      lightbox.style.display = 'none';
    }

    function nextImage() {
      currentIndex = (currentIndex + 1) % imageData.length;
      showImage();
    }

    function prevImage() {
      currentIndex = (currentIndex - 1 + imageData.length) % imageData.length;
      showImage();
    }

    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') closeLightbox();
      if (e.key === 'ArrowRight') nextImage();
      if (e.key === 'ArrowLeft') prevImage();
    });
  </script>

{% endblock body %}

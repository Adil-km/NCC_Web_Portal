{% extends 'gallery/base.html' %}
{% load static %}

{% block header %}
<link rel="stylesheet" href="{% static 'gallery/css/gallery.css' %}">
{% endblock header %}

{% block body %}

<section class="gallery-section">
<h2>Our Gallery</h2>
<div class="gallery-grid" id="galleryGrid">


{% if images %}
    {% for image in images %}

	<img src="{{ image.image.url }}" alt="Image" data-desc="{{ image.description }}">

    {% endfor %}
{% else %}
    <p>No images.</p>
{% endif %}


    </div>
  </section>

  <div class="lightbox" id="lightbox">
    <span class="close" onclick="closeLightbox()">×</span>
    <span class="prev" onclick="prevImage()">❮</span>
    <img id="lightboxImg" src="" alt="">
    <div class="description" id="imgDescription"></div>
    <span class="next" onclick="nextImage()">❯</span>
  </div>

  <script>
    const galleryImages = document.querySelectorAll('#galleryGrid img');
    const lightbox = document.getElementById('lightbox');
    const lightboxImg = document.getElementById('lightboxImg');
    const imgDescription = document.getElementById('imgDescription');

    const imageData = Array.from(galleryImages).map(img => ({
      src: img.src,
      desc: img.getAttribute('data-desc')
    }));

    let currentIndex = 0;

    galleryImages.forEach((img, index) => {
      img.addEventListener('click', () => {
        currentIndex = index;
        showImage();
      });
    });

    function showImage() {
      lightboxImg.src = imageData[currentIndex].src;
      imgDescription.textContent = imageData[currentIndex].desc;
      lightbox.style.display = 'flex';
    }

    function closeLightbox() {
      lightbox.style.display = 'none';
    }

    function nextImage() {
      currentIndex = (currentIndex + 1) % imageData.length;
      showImage();
    }

    function prevImage() {
      currentIndex = (currentIndex - 1 + imageData.length) % imageData.length;
      showImage();
    }

    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') closeLightbox();
      if (e.key === 'ArrowRight') nextImage();
      if (e.key === 'ArrowLeft') prevImage();
    });
  </script>

{% endblock body %}
